---
title: js测试阿里云API：全国天气预报查询（免费版）
date: 2018-09-05 19:08:11
categories: 测试
tags: 
- JavaScript
- API测试
---
前几天，在实习的公司里，要使用vue+webpack开发一个门店拜访的app，被分到了编写天气预报组件，然后就找了阿里云的免费天气预报API，传送门：<a href="https://market.aliyun.com/products/57126001/cmapi014302.html" target="_blank">https://market.aliyun.com/products/57126001/cmapi014302.html</a>

不过要使用阿里云服务需要先注册一个阿里云的账号，这里就不赘述了，注册完以后购买该免费服务，然后就会获得AppKey，AppSecret和AppCode。

然后我们可以看看调用接口需要的请求参数：

<style>
table th:nth-of-type(1) {
    width: 15%;
}
table th:nth-of-type(2) {
    width: 15%;
}
table th:nth-of-type(3) {
    width: 15%;
}
table th:nth-of-type(4) {
    width: 40%;
}
</style>

| 名称 | 类型 | 是否必须 | 描述 |
| :------: | :------: | :------: | :----: |
| city | STRING | 可选 | 城市（city,cityid,citycode三者任选其一） |
| citycode | STRING | 可选 | 城市天气代号（city,cityid,citycode三者任选其一） |
| cityid | STRING | 可选 | 城市ID（city,cityid,citycode三者任选其一） |
| ip | STRING | 可选 | IP |
| location | STRING | 可选 | 经纬度 纬度在前，,分割 如：39.983424,116.322987 |

以上五个参数我选择了直接使用城市名来进行测试，具体代码如下：
```js
$.ajax({
            type: "GET",
            url: "http://jisutqybmf.market.alicloudapi.com/weather/query",
            data: {city: '杭州'},
            success: function (data) {
                console.log(data); //请求成功后操作
            },
            beforeSend: function (xhr) {
                xhr.setRequestHeader("Authorization", "APPCODE /*此处是自己的APPCODE*/");
            }
        });
```
如果发送请求失败，返回的错误码如下：

|错误码	|错误信息	|描述|
| :------: | :------: | :------: |
|201	|City and city ID and city code are empty|	城市和城市ID和城市代号都为空|
|202	|City does not exist|	城市不存在|
|203	|There is no weather information in this city|	此城市没有天气信息|
|210	|No information|	没有信息|
在返回结果中天气是有图片的，天气图片可以<a href="http://api.jisuapi.com/weather/icon.zip?spm=5176.730006-56956004-57126001-cmapi014302/A.content.12.4f901460cUsWvl&file=icon.zip" target="_blank">点此下载</a>

需要特别注意的是**接口流量限制情况（每个用户ID）：30次流控/分钟**。当然，如果是付费版就不存在限流的问题了。